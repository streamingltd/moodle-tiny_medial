define("tiny_medial/link",["exports","core/templates","core/pending","./options"],(function(_exports,_templates,_pending,_options){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Link helper for Tiny Link plugin.
   *
   * @module      tiny_medial/link
   * @copyright   2023 Tim Williams, Streaming Ltd <tim@medial.com>
   * @license     http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.setMedialLink=_exports.setLinkCustom=_exports.setLink=void 0,_templates=_interopRequireDefault(_templates),_pending=_interopRequireDefault(_pending);_exports.setLink=(preid,inserttype,editor)=>{var xmlDoc=new XMLHttpRequest,params="resource_link_id="+preid+"&user_id="+(0,_options.getUserId)(editor)+"&oauth_consumer_key="+(0,_options.getOauthConsumerKey)(editor)+"&context_id="+(0,_options.getCourse)(editor)+"&include_height=Y";xmlDoc.onload=response=>{const pendingPromise=new _pending.default("tiny_medial/setLink");checkResponse(preid,inserttype,editor,response).then(pendingPromise.resolve).catch((error=>{console.log(error)}))},xmlDoc.open("POST",(0,_options.getPlayerSizeUrl)(editor),!0),xmlDoc.setRequestHeader("Content-type","application/x-www-form-urlencoded"),xmlDoc.send(params)};const checkResponse=async(preid,inserttype,editor,response)=>{if(!(response.target.status<200&&response.target.status>=400)){var resp=response.target.responseText.split(":"),audioonly=0;3==resp.length&&"Y"==resp[2]&&(audioonly=1),setMedialLink(preid,inserttype,editor,audioonly,(0,_options.getViewLaunchType)(editor),getTemplate(inserttype,editor),"",!1)}};_exports.setLinkCustom=(preid,inserttype,editor,data)=>{if(!("title"in data)||!("custom"in data)||!("audioonly"in data.custom))return console.log("Bad message data"),void console.log(data);var audioonly=0;"true"==data.custom.audioonly.toLowerCase()&&(audioonly=1),setMedialLink(preid,inserttype,editor,audioonly,(0,_options.getViewLaunchType)(editor),getTemplate(inserttype,editor),data.title,data.custom.video_ref)};const getTemplate=(inserttype,editor)=>(0,_options.getLinkOnly)(editor)||"iframe"!=inserttype?"tiny_medial/link":"tiny_medial/iframe",setMedialLink=async(preid,inserttype,editor,audioonly,launchtype,template,title,videoref)=>{var url=getEmbedUrl(editor)+"?type="+launchtype+"&responsive=1&medialembed="+inserttype+"&audioonly="+audioonly+"&l="+preid;videoref&&(url+="&video_ref="+videoref);var context={url:url,title:title,bs5:(0,_options.getBs5)(editor)};1==audioonly&&(context.audioonly=!0);const{html:html}=await _templates.default.renderForPromise(template,context);window.console.log(html),editor.insertContent(html)};_exports.setMedialLink=setMedialLink;const getEmbedUrl=editor=>1==(0,_options.getPlaceholder)(editor)?"{{{medial_launch_base}}}/mod/helixmedia/launch.php":(0,_options.getBaseurl)(editor)+"/mod/helixmedia/launch.php"}));

//# sourceMappingURL=link.min.js.map